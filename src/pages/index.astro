---
import Search from "astro-pagefind/components/Search";
import '@/styles/pagefind-ui-custom.css';
import siteConfig from '@/siteConfig.json';
import { getSlugName } from '@/scripts/urlUtils';
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogPostCard from "@/components/BlogPostCard.astro";
import HeroCard from '@/components/HeroCard.astro';
import Card from '@/components/Card.astro';
import ButtonLink from '@/components/ButtonLink.astro';

import javImg from '/public/assets/img/javguerra.png';

const href = "/acerca-de";

const allPosts: Record<string, any>[] = await getCollection('posts');
let post;
if (allPosts.length) {
  const sortedPosts = allPosts.sort(
    (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
  )
  const lastPost = sortedPosts[0];
  post = { ...lastPost };
  post.data = { ...post.data };
  const title = "Nuevo: " + post.data.title;
  post.data.title = title;
}
---

<BaseLayout pageTitle={siteConfig.default.autor} subTitle={siteConfig.default.description}>

  <h2>Bienvenida</h2>

  <ul class="-mt-4">
    <div class="my-8">
      <HeroCard href={href} img={javImg} alt="Javier Guerra"
        styles="mx-auto md:ml-auto mb-4 md:mb-0 w-[192px] border-2 rounded-full">
        <div class="text-center md:text-left">

          <p class="text-2xl leading-snug md:leading-relaxed">üëãüèª&nbsp;Soy&nbsp;<strong>Javier&nbsp;Guerra</strong>, t√©cnico&nbsp;superior&nbsp;DAW.</p>

          <p class="mt-2">Explora aqu√≠ la informaci√≥n sobre mi experiencia profesional, conocimientos t√©cnicos y m√©ritos.</p>

          <div class="md:flex md:flex-row-reverse">
            {siteConfig.default.opentowork &&
              <div class="mt-2 md:mt-3">
                <small>&nbsp;&nbsp;üü¢&nbsp;<strong>disponible&nbsp;para&nbsp;trabajar&nbsp;&nbsp;</strong></small>
              </div>
            }
            <div class="w-full mt-5 mb-2 md:mt-3 md:mb-0">
              <ButtonLink href={href} text="Sobre&nbsp;mi&nbsp;‚Üí" />
            </div>
          </div>
        </div>
      </HeroCard>
    </div>

    <Card href="/portfolio" title="Portfolio">
      Visita mi portfolio para saber algo m√°s sobre mis conocimientos aplicados.
    </Card>
  </ul>

  <ul role="list" class="link-card-grid mt-8">
    <Card href="/blog/1" title="Blog">
      Conoce algo m√°s sobre los temas de estudio que me interesan
    </Card>
    <Card href="/temas" title="Temas">
      Accede a la lista de temas del blog y a los enlaces recomendados
    </Card>
  </ul>

  <dir class="mt-8 ps-0">
    <Search id="search" aria-label="Buscar" className="pagefind-ui" uiOptions={{ showImages: false }} />
  </dir>
  
  { post && 
    <ul class="my-8 text-center md:text-left">
      <BlogPostCard
        frontmatter={post.data}
        href=`${post.data.route || getSlugName(post.slug)}`
      />
    </ul>
  }
    
</BaseLayout>